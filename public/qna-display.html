<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Q&A Display</title>
    <style>
      :root { --bg:#0a0b0f; --ink:#eaeef6; --muted:#9aa3b2; --accent:#b76a5b; --glass: rgba(255,255,255,0.06); --stroke: rgba(255,255,255,0.10); --shadow: 0 10px 40px rgba(0,0,0,.45), inset 0 1px 0 rgba(255,255,255,.04); }
      html,body { height: 100%; }
      body { margin: 0; background: radial-gradient(1200px 800px at 80% 0%, #11131a 0%, #0a0b0f 60%); color: var(--ink); font-family: system-ui,-apple-system,sans-serif; }
      .wrap { display:flex; align-items:flex-start; justify-content:center; height:100%; padding: 24px; overflow:auto; }
      .card { width: min(1200px, 96%); border: 1px solid var(--stroke); border-radius: 20px; background: var(--glass); padding: 24px 28px; box-shadow: var(--shadow); backdrop-filter: blur(12px) saturate(140%); }
      .label { color: var(--muted); font-weight: 800; text-transform: uppercase; letter-spacing: .8px; }
      .question { font-size: 40px; font-weight: 900; margin: 8px 0 10px 0; color: var(--ink); }
      .answer { font-size: 24px; color: var(--accent); }
      .meta { color: var(--muted); font-weight:700; margin-top: 4px; }
      .stack { width: min(1200px, 96%); display:flex; flex-direction:column; gap:16px; }
      .small { font-size: 14px; }
    </style>
  </head>
  <body>
    <div class="wrap">
      <div class="stack">
        <div style="display:flex; align-items:center; gap:12px; margin-bottom:8px;">
          <img src="/assets/logo.png" alt="Alef" style="height:28px;"/>
          <div class="label">Q&A Display</div>
        </div>
        <div class="card" id="currentBox" style="display:none;">
          <div class="label">Currently Answering</div>
          <div id="q" class="question">Waiting for selection…</div>
          <div id="meta" class="meta"></div>
        </div>
        <div class="card">
          <div class="label">Answered Questions</div>
          <div id="answers"></div>
        </div>
      </div>
    </div>
    <script>
      async function refresh() {
        const [hid, list] = await Promise.all([
          fetch('/api/qna/highlight').then(r => r.json()),
          fetch('/api/qna/list').then(r => r.json())
        ]);

        const currentBox = document.getElementById('currentBox');
        if (hid.id) {
          const cur = list.qna.find(i => i.id === hid.id);
          if (cur && !cur.answered) {
            currentBox.style.display = '';
            document.getElementById('q').textContent = cur.text;
            document.getElementById('meta').textContent = `Asked by ${cur.user || 'Anonymous'} • #${cur.id}`;
          } else {
            currentBox.style.display = 'none';
          }
        } else {
          currentBox.style.display = 'none';
        }

        const answered = list.qna.filter(i => i.answered && i.answer_text);
        answered.sort((a,b) => a.id - b.id); // chronological
        const answersEl = document.getElementById('answers');
        answersEl.innerHTML = answered.length ? answered.map(i => `
          <div style=\"border-top:1px dashed #2a2933; padding-top:14px; margin-top:14px;\">
            <div class=\"question\">${i.text}</div>
            <div class=\"meta\">Asked by ${i.user || 'Anonymous'} • #${i.id}</div>
            <div class=\"small muted\" style=\"margin-top:4px;\">Answer</div>
            <div class=\"answer\">${i.answer_text}</div>
          </div>
        `).join('') : `<div class=\"meta\">No answers yet.</div>`;
      }

      const s = document.createElement('script');
      s.src = '/socket.io/socket.io.js';
      s.onload = () => {
        const socket = io();
        socket.on('qnaHighlighted', refresh);
        socket.on('qnaAnswered', refresh);
        socket.on('qnaSubmitted', refresh);
      };
      document.body.appendChild(s);

      refresh();
    </script>
  </body>
  </html>


