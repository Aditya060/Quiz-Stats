<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Q&A Display</title>
    <style>
      :root { --bg:#0a0b0f; --ink:#eaeef6; --muted:#9aa3b2; --accent:#b76a5b; --glass: rgba(255,255,255,0.06); --stroke: rgba(255,255,255,0.10); --shadow: 0 10px 40px rgba(0,0,0,.45), inset 0 1px 0 rgba(255,255,255,.04); }
      html,body { height: 100%; }
      body { margin: 0; background: radial-gradient(1200px 800px at 80% 0%, #11131a 0%, #0a0b0f 60%); color: var(--ink); font-family: system-ui,-apple-system,sans-serif; }
      .wrap { display:flex; align-items:flex-start; justify-content:center; height:100%; padding: 24px; overflow:auto; }
      .card { width: min(1200px, 96%); border: 1px solid var(--stroke); border-radius: 20px; background: var(--glass); padding: 24px 28px; box-shadow: var(--shadow); backdrop-filter: blur(12px) saturate(140%); }
      .label { color: var(--muted); font-weight: 800; text-transform: uppercase; letter-spacing: .8px; }
      .question { font-size: 40px; font-weight: 900; margin: 8px 0 10px 0; color: var(--ink); }
      .answer { font-size: 24px; color: var(--accent); }
      .meta { color: var(--muted); font-weight:700; margin-top: 4px; }
      .stack { width: min(1200px, 96%); display:flex; flex-direction:column; gap:16px; }
      .small { font-size: 14px; }
      .btn { padding: 8px 12px; border:1px solid var(--accent); border-radius: 10px; background: linear-gradient(180deg, color-mix(in oklab, var(--accent), white 8%), var(--accent)); color: #0a0b0f; cursor: pointer; font-weight: 800; box-shadow: 0 8px 26px rgba(183,106,91,.35); transition: transform .15s ease, box-shadow .2s ease; }
      .btn:hover { transform: translateY(-1px); box-shadow: 0 16px 44px rgba(183,106,91,.45); }

      /* Ultra-wide LED wall (≈4992x1512, ~3.3:1) */
      @media (min-aspect-ratio: 33/10) {
        .wrap { padding: 40px; }
        .card { border-radius: 24px; padding: 36px 40px; }
        .label { font-size: 28px; }
        .question { font-size: 64px; }
        .answer { font-size: 36px; }
        .meta { font-size: 24px; }
      }
    </style>
  </head>
  <body>
    <div class="wrap">
      <div class="stack">
        <div style="display:flex; align-items:center; gap:12px; margin-bottom:8px;">
          <img src="/assets/logo-white.png" alt="Alef" style="height:28px;"/>
        </div>
        <div id="overlay" style="position:fixed; inset:0; display:none; align-items:center; justify-content:center; background: rgba(0,0,0,.65); z-index: 50;">
          <div class="card" style="max-width: 900px; text-align:center;">
            <div id="hq" class="question" style="margin:0;">Question</div>
          </div>
        </div>
        <div class="card" id="currentBox" style="display:none;">
          <div id="q" class="question">Waiting for selection…</div>
        </div>
        <div class="card">
          <div id="answers"></div>
        </div>
      </div>
    </div>
    <script>
      async function refresh() {
        const [hid, list] = await Promise.all([
          fetch('/api/qna/highlight', { cache: 'no-store' }).then(r => r.json()),
          fetch('/api/qna/list', { cache: 'no-store' }).then(r => r.json())
        ]);

        const currentBox = document.getElementById('currentBox');
        // Full-screen overlay for highlight (even if answered)
        const overlay = document.getElementById('overlay');
        if (hid.id) {
          const cur = list.qna.find(i => i.id === hid.id);
          if (cur) {
            overlay.style.display = 'flex';
            document.getElementById('hq').textContent = cur.text;
          } else {
            overlay.style.display = 'none';
          }
          if (cur && !cur.answered) {
            currentBox.style.display = '';
            document.getElementById('q').textContent = cur.text;
          } else {
            currentBox.style.display = 'none';
          }
        } else {
          document.getElementById('overlay').style.display = 'none';
          currentBox.style.display = 'none';
        }

        const answered = list.qna; // show all submissions, question only
        answered.sort((a,b) => a.id - b.id); // chronological
        const answersEl = document.getElementById('answers');
        answersEl.innerHTML = answered.length ? answered.map(i => `
          <div style=\"border-top:1px dashed #2a2933; padding-top:14px; margin-top:14px;\">
            <div class=\"question\">${i.text}</div>
            
          </div>
        `).join('') : `<div class=\"meta\">No answers yet.</div>`;
      }

      const s = document.createElement('script');
      s.src = '/socket.io/socket.io.js';
      s.onload = () => {
        const socket = io();
        socket.on('qnaHighlighted', refresh);
        socket.on('qnaAnswered', refresh);
        socket.on('qnaSubmitted', refresh);
        socket.on('qnaRejected', refresh);
      };
      document.body.appendChild(s);

      refresh();
    </script>
  </body>
  </html>


